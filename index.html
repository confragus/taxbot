<!DOCTYPE html>

<html>
  <head>
    <link href="./styles.css" type="text/css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:400,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans:400,700" rel="stylesheet">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="./Chart.bundle.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

    </script>

    <title>tax_bot</title>
  </head>

  <body>
    <div class="limiter">
      <h1 class="title"><a href="#">tax_bot</a></h1>

      <ul>
        <li><a href="#">MORE INFORMATION</a></li>
        <li><a href="#">ABOUT US</a></li>
      </ul>

      <div class="limiter-2">
        <div class="grid-calc">
          <div class="item1 division-line">
            <span class="input-title">YOUR TAXABLE INCOME</span>
            <input type="text" id="user_income" value="50000">
          </div>
          <div class="item2">
            <table>
              <tr>
                <th class="table-title" colspan="2">INCOME</th>
              </tr>
              <tr class="table-important">
                <th>Net Income</th>
                <td>$<span id="s_net_income"></span></td>
              </tr>
              <tr>
                <th>Income / month</th>
                <td>$<span id="s_net_income_pm"></span></td>
              </tr>
              <tr>
                <th>Income / week</th>
                <td>$<span id="s_net_income_pw"></span></td>
              </tr>
            </table>
          </div>
          <div class="item3">
            <table>
              <tr>
                <th class="table-title" colspan="2">TAX</th>
              </tr>
              <tr class="table-important">
                <th>Total</th>
                <td>$<span id="s_total_tax"></span></td>
              </tr>
              <tr>
                <th>Tax Percentage</th>
                <td><span id="s_percent_tax"></span>%</td>
              </tr>
              <tr>
                <th>Income Tax</th>
                <td>$<span id="s_income_tax"></span></td>
              </tr>
              <tr>
                <th>Medicare</th>
                <td>$<span id="s_medicare"></span></td>
              </tr>
              <tr>
                <th>Tax Offset</th>
                <td><span id="s_tax_offset"></span></td>
              </tr>
            </table>
          </div>
          <div class="item4 division-line"><h2 class="division-title">Graphs</h2></div>
          <div class="item5 graph-pie">
            <canvas id="myChart" width="undefined" height="undefined"></canvas>
          </div>
        </div>
      </div>
    </div>
    <script>
      function f_income_tax(taxable){
        if( taxable <= 18200) {
          return 0;
        }
        if( taxable <= 37000) {
          return (taxable-18200)*.19;
        }
        if( taxable <= 90000) {
          return (taxable-37000)*.325+3572;
        }
        if( taxable <= 180000) {
          return (taxable-90000)*.37+20797;
        }
        if( taxable > 180000) {
          return (taxable-180000)*.45+54097;
        }
      }

      function f_medicare(taxable){
        if( taxable <= 21980) {
          return 0;
        }
        if (taxable <= 27475) {
          return 0.1*(taxable-21980);
        }
        else {
          return 0.02*taxable;
        }
      }

      function f_low_income(taxable){
        if( taxable <= 37000) {
          return 445;
        }
        if (taxable <= 66667) {
          return 445 - 0.015*(taxable - 37000);
        }
        else {
          return 0
        }
      }

      function f_tax_percent(taxable){
        return (f_income_tax(taxable) + f_medicare(taxable) - f_low_income(taxable)) / taxable
      }

      var user_income = document.getElementById('user_income');
      var income_tax = document.getElementById('s_income_tax');
      var medicare = document.getElementById('s_medicare');
      var percent_tax = document.getElementById('s_percent_tax');
      var total_tax = document.getElementById('s_total_tax');
      var net_income = document.getElementById('s_net_income');
      var tax_offset = document.getElementById('s_tax_offset');
      var net_income_pm = document.getElementById('s_net_income_pm');
      var net_income_pw = document.getElementById('s_net_income_pw');
      var income_tax_uc;
      var medicare_uc;
      var percent_tax_uc;
      var total_tax_uc;
      var net_income_uc;
      var tax_offset_uc;
      var net_income_pm_uc;
      var net_income_pw_uc;

      function parse_html(){
        income_tax_uc = f_income_tax(user_income.value);
        medicare_uc = f_medicare(user_income.value);
        tax_offset_uc = f_low_income(user_income.value)
        total_tax_uc = parseFloat(income_tax_uc) +
                       parseFloat(medicare_uc) -
                       parseFloat(tax_offset_uc);
        percent_tax_uc =  f_tax_percent(user_income.value) * 100;
        net_income_uc = user_income.value - parseFloat(total_tax_uc);
        net_income_pm_uc = parseFloat(net_income_uc)/12;
        net_income_pw_uc = parseFloat(net_income_uc)/52;

        income_tax.innerHTML = income_tax_uc.toFixed(2);
        medicare.innerHTML = medicare_uc.toFixed(2);
        tax_offset.innerHTML = "(-$" + tax_offset_uc.toFixed(2) + ")";
        total_tax.innerHTML = total_tax_uc.toFixed(2);
        percent_tax.innerHTML = percent_tax_uc.toPrecision(4);
        net_income.innerHTML = net_income_uc.toFixed(2);
        net_income_pm.innerHTML = net_income_pm_uc.toFixed(2);
        net_income_pw.innerHTML = net_income_pw_uc.toFixed(2);
      }

      // Pie Chart //
      var ctx = document.getElementById("myChart");

      function drawPieChart() {
          var pieChart = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: ['Net Income', 'Income Tax', 'Medicare'],
            datasets: [{
              data: [net_income_uc, income_tax_uc, medicare_uc],
              backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)'
              ],
              borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)'
              ],
              borderWidth: 1
            }],
          },
          options: {
            layout: {
              padding: {
                left: 0,
                right: 0,
                top: 0,
                bottom: 0
              }
            },
            legend: {
              display: true,
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Distribution of Total Income',
              fontColor: '#ffab1c'
            }
          }
        });
      }

      function updatePieChart() {
        pieChart.data.datasets.data = [1, 2, 3];
        pieChart.update();
      }

      user_income.addEventListener("keyup", function(event){
        parse_html();
        updatePieChart();
      });

      parse_html();
      drawPieChart();
      updatePieChart();

    </script>
  </body>
</html>
